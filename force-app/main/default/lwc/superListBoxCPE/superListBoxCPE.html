<!--
  @description       : 
  @author            : ChangeMeIn@UserSettingsUnder.SFDoc
  @group             : 
  @last modified on  : 08-02-2025
  @last modified by  : ChangeMeIn@UserSettingsUnder.SFDoc
-->
<template>
    <div class="slds-form">
        <!-- Object Selection -->
        <div class="slds-form-element slds-m-bottom_small">
            <template if:true={isLoadingObjects}>
                <lightning-spinner alternative-text="Loading objects" size="small"></lightning-spinner>
            </template>
            <lightning-combobox
                name="object"
                label="Select Object"
                value={selectedObject}
                placeholder="Choose an object"
                options={objectOptions}
                onchange={handleObjectChange}
                disabled={isLoadingObjects}
                required
            ></lightning-combobox>
        </div>

        <!-- Field Selection -->
        <template if:true={selectedObject}>
            <div class="slds-form-element slds-m-bottom_small">
                <template if:true={isLoadingFields}>
                    <lightning-spinner alternative-text="Loading fields" size="small"></lightning-spinner>
                </template>
                <lightning-combobox
                    name="field"
                    label="Select Multi-Select Picklist Field"
                    value={selectedField}
                    placeholder="Choose a multi-select picklist field"
                    options={fieldOptions}
                    onchange={handleFieldChange}
                    disabled={isLoadingFields}
                    required
                ></lightning-combobox>
            </div>

            <!-- Initial Selected Values -->
            <div class="slds-form-element slds-m-bottom_small">
                <c-string-array-combobox
                    label="Initial Selected Values"
                    value={initialSelectedValuesForCombobox}
                    builder-context={builderContext}
                    automatic-output-variables={automaticOutputVariables}
                    onvaluechanged={handleInitialSelectedValuesChange}
                    field-level-help="Enter comma-separated values or select a Flow variable (collection)"
                    builder-context-filter-collection-boolean="true"
                    allow-hard-code-reference="true"
                    value-data-type="String"
                ></c-string-array-combobox>
            </div>
            
            <!-- Picklist Value Definitions -->
            <template if:true={showPicklistDefinitions}>
                <div class="slds-m-top_small">
                    <h3 class="slds-text-heading_small slds-m-bottom_x-small">Picklist Value Definitions</h3>
                    <p class="slds-text-body_small slds-text-color_weak slds-m-bottom_small">
                        Define custom help text for each picklist value
                    </p>
                    
                    <!-- Help Text Display Mode -->
                    <div class="slds-form-element slds-m-bottom_small">
                        <label class="slds-form-element__label">Help Text Display Mode</label>
                        <div class="slds-form-element__control">
                            <lightning-button-group>
                                <lightning-button-stateful
                                    label-when-off="Help Bubble"
                                    label-when-on="Help Bubble"
                                    icon-name-when-off="utility:info"
                                    icon-name-when-on="utility:info"
                                    selected={isBubbleMode}
                                    variant={bubbleButtonVariant}
                                    onclick={handleBubbleModeClick}>
                                </lightning-button-stateful>
                                <lightning-button-stateful
                                    label-when-off="Subtitle Text"
                                    label-when-on="Subtitle Text"
                                    icon-name-when-off="utility:text"
                                    icon-name-when-on="utility:text"
                                    selected={isSubtitleMode}
                                    variant={subtitleButtonVariant}
                                    onclick={handleSubtitleModeClick}>
                                </lightning-button-stateful>
                            </lightning-button-group>
                        </div>
                    </div>
                    
                    <!-- Enable Option Icons -->
                    <div class="slds-form-element slds-m-bottom_small">
                        <lightning-input
                            type="checkbox"
                            label="Enable Option Icons"
                            checked={enableOptionIcons}
                            onchange={handleEnableOptionIconsChange}
                            field-level-help="Display icons next to picklist options">
                        </lightning-input>
                    </div>
                    
                    <div class="slds-box slds-box_x-small slds-theme_shade">
                        <template for:each={picklistValues} for:item="picklistValue">
                            <div key={picklistValue.value} class="slds-form-element slds-m-bottom_x-small">
                                <label class="slds-form-element__label slds-text-body_small">
                                    <strong>{picklistValue.label}</strong> ({picklistValue.value})
                                </label>
                                <div class="slds-form-element__control">
                                    <lightning-input
                                        type="text"
                                        placeholder="Enter help text"
                                        value={picklistValue.definition}
                                        data-value={picklistValue.value}
                                        onchange={handleDefinitionChange}
                                        variant="label-hidden"
                                    ></lightning-input>
                                    <template if:true={enableOptionIcons}>
                                        <div class="slds-grid slds-gutters_xx-small slds-m-top_xx-small">
                                            <div class="slds-col slds-size_10-of-12">
                                                <lightning-input
                                                    type="text"
                                                    placeholder="Icon (e.g. standard:account)"
                                                    value={picklistValue.icon}
                                                    data-value={picklistValue.value}
                                                    onchange={handleIconChange}
                                                    variant="label-hidden"
                                                ></lightning-input>
                                            </div>
                                            <div class="slds-col slds-size_2-of-12 slds-text-align_right">
                                                <lightning-button-icon
                                                    icon-name="utility:palette"
                                                    alternative-text="Select Icon"
                                                    title="Select Icon"
                                                    data-value={picklistValue.value}
                                                    onclick={handleOpenIconPicker}
                                                    variant="border-filled"
                                                    size="medium"
                                                ></lightning-button-icon>
                                            </div>
                                        </div>
                                    </template>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>
            </template>
        </template>

        <!-- Standard Configuration -->
        <div class="slds-form-element slds-m-bottom_small">
            <lightning-input
                label="Card Title"
                value={cardTitle}
                onchange={handleCardTitleChange}
            ></lightning-input>
        </div>

        <div class="slds-form-element slds-m-bottom_small">
            <lightning-input
                label="Record Type ID (Optional)"
                value={selectedRecordTypeId}
                onchange={handleRecordTypeIdChange}
                placeholder="Leave blank for default record type"
            ></lightning-input>
        </div>

        <div class="slds-form-element slds-m-bottom_small">
            <lightning-input
                type="checkbox"
                label="Is Required"
                checked={isRequired}
                onchange={handleIsRequiredChange}
            ></lightning-input>
        </div>

    </div>
    
    <!-- Icon Picker Modal -->
    <template if:true={showIconPickerModal}>
        <section role="dialog" tabindex="-1" class="slds-modal slds-fade-in-open slds-modal_large">
            <div class="slds-modal__container" style="max-height: 90vh;">
                <header class="slds-modal__header">
                    <h2 class="slds-modal__title slds-hyphenate">Select Icon</h2>
                    <button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse"
                            title="Close"
                            onclick={handleCloseIconPicker}>
                        <lightning-icon icon-name="utility:close"
                                      alternative-text="close"
                                      variant="inverse"
                                      size="small">
                        </lightning-icon>
                        <span class="slds-assistive-text">Close</span>
                    </button>
                </header>
                <div class="slds-modal__content slds-p-around_medium" style="height: calc(90vh - 8rem); overflow-y: auto;">
                    <c-fsc_pick-icon
                        icon-name={currentIconForPicker}
                        mode="tab"
                        oniconselection={handleIconSelection}>
                    </c-fsc_pick-icon>
                </div>
                <footer class="slds-modal__footer">
                    <lightning-button
                        label="Cancel"
                        onclick={handleCloseIconPicker}>
                    </lightning-button>
                </footer>
            </div>
        </section>
        <div class="slds-backdrop slds-backdrop_open"></div>
    </template>
</template>